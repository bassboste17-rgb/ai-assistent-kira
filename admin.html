<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin — DAMQ Travel</title>
  <link rel="icon" type="image/svg+xml" href="icon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,700;1,400&display=swap" rel="stylesheet">

  <style>
    /* ═══════════════════════════════════════════
       RESET & VARIABLES
    ═══════════════════════════════════════════ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --gold:      #d4af37;
      --gold-h:    #f0c040;
      --dark:      #0a0a0a;
      --dark2:     #141414;
      --sidebar-w: 260px;
      --radius:    14px;
      --border:    #f0ede6;
      --bg:        #f7f5f0;
      --white:     #ffffff;
      --text:      #1a1a1a;
      --muted:     #888;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* ═══════════════════════════════════════════
       LAYOUT
    ═══════════════════════════════════════════ */
    .app {
      display: flex;
      min-height: 100vh;
    }

    /* ───── SIDEBAR ───── */
    .sidebar {
      width: var(--sidebar-w);
      background: var(--dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0; left: 0; bottom: 0;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .sidebar-logo {
      padding: 1.8rem 1.5rem 1.2rem;
      border-bottom: 1px solid rgba(255,255,255,0.07);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .sl-text   { font-family: 'Playfair Display', serif; font-size: 1.25rem; font-weight: 700; color: #fff; letter-spacing: 0.06em; }
    .sl-div    { width: 2px; height: 16px; background: var(--gold); border-radius: 2px; flex-shrink: 0; }
    .sl-sub    { font-size: 0.58rem; font-weight: 700; letter-spacing: 0.16em; text-transform: uppercase; color: #666; }

    .sidebar-badge {
      margin: 0.8rem 1.2rem 0.6rem;
      background: rgba(212,175,55,0.1);
      border: 1px solid rgba(212,175,55,0.2);
      border-radius: 8px;
      padding: 0.45rem 0.8rem;
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--gold);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .sidebar-nav { flex: 1; padding: 0.4rem 0; overflow-y: auto; }

    .nav-label {
      font-size: 0.62rem;
      font-weight: 700;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #444;
      padding: 0.9rem 1.5rem 0.35rem;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 0.68rem 1.5rem;
      color: rgba(255,255,255,0.5);
      font-size: 0.88rem;
      font-weight: 500;
      cursor: pointer;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      text-decoration: none;
      font-family: inherit;
      transition: background 0.2s, color 0.2s;
      position: relative;
    }
    .nav-item:hover { background: rgba(255,255,255,0.05); color: #fff; }
    .nav-item.active { color: #fff; background: rgba(212,175,55,0.1); }
    .nav-item.active::before {
      content: '';
      position: absolute;
      left: 0; top: 5px; bottom: 5px;
      width: 3px;
      background: var(--gold);
      border-radius: 0 3px 3px 0;
    }
    .nav-item svg { flex-shrink: 0; }

    .nav-count {
      margin-left: auto;
      background: var(--gold);
      color: var(--dark);
      font-size: 0.62rem;
      font-weight: 800;
      border-radius: 50px;
      padding: 2px 7px;
      min-width: 20px;
      text-align: center;
    }

    .sidebar-footer {
      padding: 1rem 1.2rem;
      border-top: 1px solid rgba(255,255,255,0.07);
    }
    .sidebar-user {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 0.8rem;
    }
    .user-avatar {
      width: 36px; height: 36px;
      background: rgba(212,175,55,0.15);
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      color: var(--gold);
      font-size: 0.8rem;
      font-weight: 700;
      flex-shrink: 0;
    }
    .user-info { flex: 1; min-width: 0; }
    .user-email { font-size: 0.73rem; color: rgba(255,255,255,0.45); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .user-role  { font-size: 0.68rem; color: var(--gold); font-weight: 600; }

    .btn-site {
      width: 100%;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      color: rgba(255,255,255,0.55);
      border-radius: 8px;
      padding: 0.52rem;
      font-size: 0.83rem;
      font-family: inherit;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 7px;
      transition: all 0.2s;
      text-decoration: none;
    }
    .btn-site:hover { background: rgba(212,175,55,0.1); color: var(--gold); border-color: rgba(212,175,55,0.25); }

    /* ───── MAIN ───── */
    .main {
      margin-left: var(--sidebar-w);
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .topbar {
      background: var(--white);
      border-bottom: 1px solid var(--border);
      padding: 1rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 50;
      gap: 1rem;
    }
    .topbar-left { display: flex; align-items: center; gap: 1rem; }
    .topbar-title    { font-size: 1.2rem; font-weight: 700; color: var(--dark); }
    .topbar-subtitle { font-size: 0.8rem; color: var(--muted); margin-top: 1px; }

    .hamburger {
      display: none;
      width: 36px; height: 36px;
      background: var(--white);
      border: 1.5px solid var(--border);
      border-radius: 9px;
      align-items: center; justify-content: center;
      cursor: pointer;
      color: #555;
      flex-shrink: 0;
    }

    .page { display: none; padding: 2rem; }
    .page.active { display: block; }

    /* ═══════════════════════════════════════════
       BUTTONS
    ═══════════════════════════════════════════ */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 7px;
      border-radius: 10px;
      font-size: 0.87rem;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      padding: 0.6rem 1.2rem;
    }
    .btn-dark  { background: var(--dark); color: #fff; }
    .btn-dark:hover  { background: var(--gold); color: var(--dark); }
    .btn-ghost { background: var(--white); color: #333; border: 1.5px solid var(--border); }
    .btn-ghost:hover { border-color: var(--gold); background: #faf9f6; }
    .btn-danger-s { background: #ef4444; color: #fff; }
    .btn-danger-s:hover { background: #dc2626; }

    .btn-icon {
      width: 32px; height: 32px;
      border-radius: 8px;
      border: 1.5px solid var(--border);
      background: var(--white);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      color: #666;
      transition: all 0.2s;
    }
    .btn-icon.edit:hover   { border-color: var(--gold); color: var(--gold); background: rgba(212,175,55,0.06); }
    .btn-icon.del:hover    { border-color: #ef4444; color: #ef4444; background: rgba(239,68,68,0.06); }
    .btn-icon.approve:hover{ border-color: #16a34a; color: #16a34a; background: rgba(34,197,94,0.06); }

    /* ═══════════════════════════════════════════
       CARDS & STATS
    ═══════════════════════════════════════════ */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
      gap: 1.2rem;
      margin-bottom: 1.8rem;
    }
    .stat-card {
      background: var(--white);
      border-radius: var(--radius);
      padding: 1.3rem 1.4rem;
      border: 1px solid var(--border);
      display: flex;
      align-items: flex-start;
      gap: 1rem;
    }
    .stat-icon {
      width: 44px; height: 44px;
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .si-gold   { background: rgba(212,175,55,0.12); color: var(--gold); }
    .si-green  { background: rgba(34,197,94,0.10);  color: #16a34a; }
    .si-blue   { background: rgba(59,130,246,0.10); color: #2563eb; }
    .si-purple { background: rgba(168,85,247,0.10); color: #7c3aed; }
    .stat-val   { font-size: 1.7rem; font-weight: 700; color: var(--dark); line-height: 1; margin-bottom: 0.3rem; }
    .stat-lbl   { font-size: 0.8rem; color: var(--muted); }

    /* ═══════════════════════════════════════════
       TABLE CARD
    ═══════════════════════════════════════════ */
    .card {
      background: var(--white);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      overflow: hidden;
    }
    .card-head {
      padding: 1.1rem 1.4rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .card-title { font-size: 0.97rem; font-weight: 700; color: var(--dark); }

    .search {
      padding: 0.52rem 0.9rem;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      font-size: 0.86rem;
      font-family: inherit;
      outline: none;
      min-width: 190px;
      transition: border-color 0.2s;
    }
    .search:focus { border-color: var(--gold); }

    .table {
      width: 100%;
      border-collapse: collapse;
    }
    .table th {
      background: #faf9f6;
      padding: 0.75rem 1.1rem;
      text-align: left;
      font-size: 0.74rem;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.05em;
      text-transform: uppercase;
      border-bottom: 1px solid var(--border);
      white-space: nowrap;
    }
    .table td {
      padding: 0.95rem 1.1rem;
      font-size: 0.86rem;
      color: #333;
      border-bottom: 1px solid #f5f3ee;
      vertical-align: middle;
    }
    .table tr:last-child td { border-bottom: none; }
    .table tr:hover td { background: #faf9f6; }
    .action-btns { display: flex; gap: 0.35rem; }
    .loading-row td { text-align: center; padding: 2.5rem; color: #bbb; font-size: 0.88rem; }

    /* ═══════════════════════════════════════════
       BADGE
    ═══════════════════════════════════════════ */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 3px 9px;
      border-radius: 50px;
      font-size: 0.73rem;
      font-weight: 600;
    }
    .b-gold   { background: rgba(212,175,55,0.12); color: #b8960f; }
    .b-green  { background: rgba(34,197,94,0.10);  color: #15803d; }
    .b-blue   { background: rgba(59,130,246,0.10); color: #1d4ed8; }
    .b-red    { background: rgba(239,68,68,0.10);  color: #b91c1c; }
    .b-gray   { background: #f3f3f3; color: #666; }

    /* ═══════════════════════════════════════════
       TOUR IMAGE THUMB
    ═══════════════════════════════════════════ */
    .thumb {
      width: 46px; height: 34px;
      border-radius: 6px;
      object-fit: cover;
      background: var(--border);
      flex-shrink: 0;
    }
    .tour-name-cell { display: flex; align-items: center; gap: 9px; }
    .stars { color: var(--gold); font-size: 0.82rem; letter-spacing: 1px; }

    /* ═══════════════════════════════════════════
       LOADING OVERLAY
    ═══════════════════════════════════════════ */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(10,10,10,0.5);
      z-index: 900;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
      backdrop-filter: blur(4px);
    }
    .overlay.show { opacity: 1; pointer-events: all; }
    .overlay-box {
      background: var(--white);
      border-radius: 20px;
      padding: 2.2rem 2.8rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      box-shadow: 0 24px 64px rgba(0,0,0,0.22);
      min-width: 210px;
      text-align: center;
    }
    .spinner {
      width: 46px; height: 46px;
      border: 4px solid #f0ede6;
      border-top-color: var(--gold);
      border-radius: 50%;
      animation: spin 0.75s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .overlay-label { font-size: 0.92rem; font-weight: 700; color: #333; }
    .overlay-sub   { font-size: 0.76rem; color: #aaa; margin-top: -0.4rem; }

    /* ═══════════════════════════════════════════
       MODAL
    ═══════════════════════════════════════════ */
    .modal-wrap {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.48);
      z-index: 800;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
    }
    .modal-wrap.open { opacity: 1; pointer-events: all; }
    .modal {
      background: var(--white);
      border-radius: 20px;
      width: 100%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      transform: translateY(18px);
      transition: transform 0.25s;
      box-shadow: 0 32px 80px rgba(0,0,0,0.22);
    }
    .modal-wrap.open .modal { transform: translateY(0); }
    .modal.sm { max-width: 440px; }
    .modal-hdr {
      padding: 1.4rem 1.5rem 0.9rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
    }
    .modal-title { font-size: 1.05rem; font-weight: 700; }
    .modal-close {
      width: 34px; height: 34px;
      border-radius: 8px;
      border: 1.5px solid var(--border);
      background: var(--white);
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      color: #666;
      transition: background 0.2s;
    }
    .modal-close:hover { background: #f5f5f5; }
    .modal-body { padding: 1.4rem; }
    .modal-ftr {
      padding: 0.9rem 1.4rem;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 0.7rem;
    }

    /* ═══════════════════════════════════════════
       FORM
    ═══════════════════════════════════════════ */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }
    .fg { display: flex; flex-direction: column; gap: 5px; }
    .fg.full { grid-column: 1 / -1; }
    .fg label { font-size: 0.8rem; font-weight: 600; color: #444; }
    .fg input, .fg select, .fg textarea {
      padding: 0.66rem 0.88rem;
      border: 1.5px solid var(--border);
      border-radius: 9px;
      font-size: 0.88rem;
      font-family: inherit;
      outline: none;
      transition: border-color 0.2s;
      background: var(--white);
      color: var(--text);
    }
    .fg input:focus, .fg select:focus, .fg textarea:focus { border-color: var(--gold); }
    .fg textarea { resize: vertical; min-height: 88px; }
    .fg-hint { font-size: 0.73rem; color: #bbb; }

    /* ═══════════════════════════════════════════
       CONFIRM MODAL
    ═══════════════════════════════════════════ */
    .confirm-body { padding: 1.8rem 1.5rem; text-align: center; }
    .confirm-icon {
      width: 60px; height: 60px;
      background: rgba(239,68,68,0.08);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 1rem;
      color: #ef4444;
    }
    .confirm-ttl { font-size: 1.05rem; font-weight: 700; margin-bottom: 0.45rem; }
    .confirm-txt { font-size: 0.87rem; color: #666; line-height: 1.6; }

    /* ═══════════════════════════════════════════
       TOAST
    ═══════════════════════════════════════════ */
    .toast {
      position: fixed;
      bottom: 1.5rem; right: 1.5rem;
      background: var(--dark);
      color: #fff;
      padding: 0.85rem 1.3rem;
      border-radius: 12px;
      font-size: 0.88rem;
      font-weight: 500;
      z-index: 999;
      box-shadow: 0 8px 28px rgba(0,0,0,0.2);
      transform: translateY(70px);
      opacity: 0;
      transition: transform 0.3s, opacity 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
      max-width: 320px;
    }
    .toast.show { transform: translateY(0); opacity: 1; }
    .toast.ok  { border-left: 4px solid #22c55e; }
    .toast.err { border-left: 4px solid #ef4444; }

    /* ═══════════════════════════════════════════
       MULTI SELECT REGIONS
    ═══════════════════════════════════════════ */
    .region-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .region-chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 5px 12px;
      border-radius: 50px;
      font-size: 0.78rem;
      font-weight: 600;
      cursor: pointer;
      border: 1.5px solid var(--border);
      background: var(--white);
      color: #555;
      transition: all 0.2s;
      user-select: none;
    }
    .region-chip:hover { border-color: var(--gold); color: var(--gold); }
    .region-chip.selected {
      background: var(--gold);
      color: var(--dark);
      border-color: var(--gold);
    }
    .region-chip.selected:hover { background: #c9a030; border-color: #c9a030; }

    /* ═══════════════════════════════════════════
       PHOTO UPLOAD
    ═══════════════════════════════════════════ */
    .upload-zone {
      border: 2px dashed var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
      position: relative;
    }
    .upload-zone:hover { border-color: var(--gold); background: rgba(212,175,55,0.03); }
    .upload-zone.dragging { border-color: var(--gold); background: rgba(212,175,55,0.06); }
    .upload-zone input[type="file"] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }
    .upload-zone-icon { color: #bbb; margin-bottom: 0.3rem; }
    .upload-zone-text { font-size: 0.82rem; color: #888; }
    .upload-zone-text strong { color: var(--gold); }

    .uploaded-photos {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 0.7rem;
    }
    .uploaded-photo {
      position: relative;
      width: 80px;
      height: 60px;
      border-radius: 8px;
      overflow: hidden;
      border: 1.5px solid var(--border);
    }
    .uploaded-photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .uploaded-photo .remove-photo {
      position: absolute;
      top: 2px;
      right: 2px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: rgba(0,0,0,0.6);
      border: none;
      color: #fff;
      font-size: 11px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
    }
    .uploaded-photo .remove-photo:hover { background: #ef4444; }

    .upload-progress {
      margin-top: 0.5rem;
      font-size: 0.78rem;
      color: var(--gold);
      display: none;
    }
    .upload-progress.active { display: block; }

    /* ═══════════════════════════════════════════
       DURATION INPUTS
    ═══════════════════════════════════════════ */
    .duration-row {
      display: flex;
      gap: 0.7rem;
      align-items: center;
    }
    .duration-row .dur-field {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .duration-row input[type="number"] {
      width: 70px;
      padding: 0.55rem 0.7rem;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      font-size: 0.86rem;
      font-family: inherit;
      outline: none;
      text-align: center;
      transition: border-color 0.2s;
    }
    .duration-row input[type="number"]:focus { border-color: var(--gold); }
    .duration-row .dur-label {
      font-size: 0.82rem;
      color: #666;
      font-weight: 500;
    }

    /* ═══════════════════════════════════════════
       RESPONSIVE
    ═══════════════════════════════════════════ */
    @media (max-width: 768px) {
      .sidebar { transform: translateX(-100%); }
      .sidebar.open { transform: translateX(0); }
      .main { margin-left: 0; }
      .hamburger { display: flex; }
      .form-grid { grid-template-columns: 1fr; }
      .table thead { display: none; }
      .table tr { display: block; border: 1px solid var(--border); border-radius: 10px; margin-bottom: 0.8rem; }
      .table td { display: flex; justify-content: space-between; align-items: center; border: none; padding: 0.55rem 0.9rem; }
      .table td::before { content: attr(data-label); font-weight: 700; font-size: 0.74rem; color: var(--muted); }
    }
  </style>
</head>
<body>

<div class="app">

  <!-- ═══════════ SIDEBAR ═══════════ -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <span class="sl-text">DAMQ</span>
      <span class="sl-div"></span>
      <span class="sl-sub">Admin</span>
    </div>
    <div class="sidebar-badge">
      <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
      Администратор
    </div>

    <nav class="sidebar-nav">
      <div class="nav-label">Главное</div>
      <button class="nav-item active" data-page="dashboard">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
        Дашборд
      </button>

      <div class="nav-label">Управление</div>
      <button class="nav-item" data-page="tours">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s-8-4.5-8-11.8A8 8 0 0 1 12 2a8 8 0 0 1 8 8.2c0 7.3-8 11.8-8 11.8z"/><circle cx="12" cy="10" r="3"/></svg>
        Туры
        <span class="nav-count" id="cntTours">0</span>
      </button>
      <button class="nav-item" data-page="dayTours">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        1-დღიანი ტურები
        <span class="nav-count" id="cntDayTours">0</span>
      </button>
      <button class="nav-item" data-page="bookings">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        Заявки
        <span class="nav-count" id="cntBookings">0</span>
      </button>
      <button class="nav-item" data-page="reviews">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
        Отзывы
        <span class="nav-count" id="cntReviews">0</span>
      </button>

      <div class="nav-label">Сайт</div>
      <a href="home.html" target="_blank" class="nav-item">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        Открыть сайт
      </a>
    </nav>

    <div class="sidebar-footer">
      <div class="sidebar-user">
        <div class="user-avatar" id="uAvatar">A</div>
        <div class="user-info">
          <div class="user-email" id="uEmail">admin@damq.ge</div>
          <div class="user-role">Администратор</div>
        </div>
      </div>
      <a href="home.html" class="btn-site">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        На главную
      </a>
    </div>
  </aside>

  <!-- ═══════════ MAIN ═══════════ -->
  <div class="main">

    <!-- Topbar -->
    <div class="topbar">
      <div class="topbar-left">
        <button class="hamburger" id="hamburger">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
        </button>
        <div>
          <div class="topbar-title" id="pgTitle">Дашборд</div>
          <div class="topbar-subtitle" id="pgSub">Обзор DAMQ Travel</div>
        </div>
      </div>
      <button class="btn btn-dark" id="btnAddTour" style="display:none;" onclick="openTourModal()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Добавить тур
      </button>
    </div>

    <!-- ─── DASHBOARD ─── -->
    <div class="page active" id="dashboardPage">
      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-icon si-gold">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s-8-4.5-8-11.8A8 8 0 0 1 12 2a8 8 0 0 1 8 8.2c0 7.3-8 11.8-8 11.8z"/><circle cx="12" cy="10" r="3"/></svg>
          </div>
          <div><div class="stat-val" id="sTours">—</div><div class="stat-lbl">Туров</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon si-green">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          </div>
          <div><div class="stat-val" id="sBookings">—</div><div class="stat-lbl">Заявок</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon si-blue">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
          </div>
          <div><div class="stat-val" id="sReviews">—</div><div class="stat-lbl">Отзывов</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon si-purple">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
          </div>
          <div><div class="stat-val" id="sPending">—</div><div class="stat-lbl">Ожидают ответа</div></div>
        </div>
      </div>
      <div class="card">
        <div class="card-head">
          <div class="card-title">Последние заявки</div>
          <button class="btn btn-ghost" onclick="switchPage('bookings')">Все заявки →</button>
        </div>
        <table class="table">
          <thead><tr><th>Имя</th><th>Тур</th><th>Телефон</th><th>Статус</th><th>Дата</th></tr></thead>
          <tbody id="recentTbody"><tr class="loading-row"><td colspan="5">Загрузка...</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- ─── TOURS ─── -->
    <div class="page" id="toursPage">
      <div class="card">
        <div class="card-head">
          <div class="card-title">Все туры</div>
          <div style="display:flex;gap:0.6rem;flex-wrap:wrap;align-items:center;">
            <input type="search" class="search" id="toursSearch" placeholder="Поиск тура...">
            <button class="btn btn-dark" onclick="openTourModal()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              Новый тур
            </button>
          </div>
        </div>
        <table class="table">
          <thead><tr><th>Название</th><th>Тип</th><th>Цена</th><th>Длит.</th><th>Группа</th><th>Метка</th><th>Действия</th></tr></thead>
          <tbody id="toursTbody"><tr class="loading-row"><td colspan="7">Загрузка...</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- ─── BOOKINGS ─── -->
    <div class="page" id="bookingsPage">
      <div class="card">
        <div class="card-head">
          <div class="card-title">Заявки клиентов</div>
          <input type="search" class="search" id="bookSearch" placeholder="Поиск по имени...">
        </div>
        <table class="table">
          <thead><tr><th>Имя</th><th>Телефон</th><th>Email</th><th>Тур</th><th>Сообщение</th><th>Статус</th><th>Дата</th><th>Действия</th></tr></thead>
          <tbody id="bookingsTbody"><tr class="loading-row"><td colspan="8">Загрузка...</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- ─── REVIEWS ─── -->
    <div class="page" id="reviewsPage">
      <div class="card">
        <div class="card-head">
          <div class="card-title">Отзывы клиентов</div>
          <input type="search" class="search" id="revSearch" placeholder="Поиск по имени...">
        </div>
        <table class="table">
          <thead><tr><th>Автор</th><th>Страна</th><th>Оценка</th><th>Отзыв</th><th>Статус</th><th>Дата</th><th>Действия</th></tr></thead>
          <tbody id="reviewsTbody"><tr class="loading-row"><td colspan="7">Загрузка...</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- ─── DAY TOURS ─── -->
    <div class="page" id="dayToursPage">
      <div class="card">
        <div class="card-head">
          <div class="card-title">1-დღიანი ტურები</div>
          <div style="display:flex;gap:0.6rem;flex-wrap:wrap;align-items:center;">
            <input type="search" class="search" id="dayToursSearch" placeholder="ტურის ძიება...">
            <button class="btn btn-dark" onclick="openDayTourModal()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              ტურის დამატება
            </button>
          </div>
        </div>
        <table class="table">
          <thead><tr><th>სახელი</th><th>რეგიონი</th><th>ტიპი</th><th>ფასი</th><th>ხანგრძლივობა</th><th>ჯგუფი</th><th>ფოტო</th><th>მოქმედება</th></tr></thead>
          <tbody id="dayToursTbody"><tr class="loading-row"><td colspan="8">იტვირთება...</td></tr></tbody>
        </table>
      </div>
    </div>

  </div><!-- /main -->
</div><!-- /app -->

<!-- ═══════════ TOUR MODAL ═══════════ -->
<div class="modal-wrap" id="tourModalWrap">
  <div class="modal">
    <div class="modal-hdr">
      <div class="modal-title" id="tourModalTitle">Новый тур</div>
      <button class="modal-close" onclick="closeTourModal()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <form id="tourForm" class="form-grid">
        <input type="hidden" id="tourDocId">
        <div class="fg full"><label>Название тура *</label><input type="text" id="fName" placeholder="Сванетия — жемчужина Кавказа" required></div>
        <div class="fg full"><label>Описание *</label><textarea id="fDesc" placeholder="Краткое описание тура..." required></textarea></div>
        <div class="fg">
          <label>Тип тура</label>
          <select id="fType">
            <option value="day">Однодневный</option>
            <option value="multi">Многодневный</option>
            <option value="wine">Винный</option>
            <option value="photo">Фототур</option>
            <option value="custom">Индивидуальный</option>
          </select>
        </div>
        <div class="fg"><label>Цена (USD) *</label><input type="number" id="fPrice" placeholder="45" min="1" required></div>
        <div class="fg"><label>Длительность</label><input type="text" id="fDuration" placeholder="1 день / 3 дня 2 ночи"></div>
        <div class="fg"><label>Размер группы</label><input type="text" id="fGroup" placeholder="1–15 чел."></div>
        <div class="fg">
          <label>Метка / Бейдж</label>
          <select id="fBadge">
            <option value="">Без метки</option>
            <option value="Хит">Хит</option>
            <option value="Топ">Топ</option>
            <option value="Новинка">Новинка</option>
            <option value="Рекомендуем">Рекомендуем</option>
          </select>
        </div>
        <div class="fg"><label>Рейтинг (1–5)</label><input type="number" id="fRating" placeholder="4.9" min="1" max="5" step="0.1"></div>
        <div class="fg full">
          <label>Ссылка на изображение</label>
          <input type="text" id="fImage" placeholder="images/tour-svaneti.jpg или https://...">
          <span class="fg-hint">Относительный путь или полный URL</span>
        </div>
        <div class="fg full"><label>Локация</label><input type="text" id="fLocation" placeholder="Сванетия, Грузия"></div>
        <div class="fg full">
          <label>Что включено (через запятую)</label>
          <input type="text" id="fIncludes" placeholder="Гид, транспорт, входные билеты, обед">
        </div>
      </form>
    </div>
    <div class="modal-ftr">
      <button class="btn btn-ghost" onclick="closeTourModal()">Отмена</button>
      <button class="btn btn-dark" onclick="saveTour()">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
        Сохранить
      </button>
    </div>
  </div>
</div>

<!-- ═══════════ BOOKING STATUS MODAL ═══════════ -->
<div class="modal-wrap" id="bookModalWrap">
  <div class="modal sm">
    <div class="modal-hdr">
      <div class="modal-title">Статус заявки</div>
      <button class="modal-close" onclick="closeBookModal()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="bookDocId">
      <div class="fg">
        <label>Изменить статус</label>
        <select id="bookStatus">
          <option value="new">Новая</option>
          <option value="contacted">Связались</option>
          <option value="confirmed">Подтверждена</option>
          <option value="completed">Завершена</option>
          <option value="cancelled">Отменена</option>
        </select>
      </div>
    </div>
    <div class="modal-ftr">
      <button class="btn btn-ghost" onclick="closeBookModal()">Отмена</button>
      <button class="btn btn-dark" onclick="saveBookStatus()">Сохранить</button>
    </div>
  </div>
</div>

<!-- ═══════════ CONFIRM MODAL ═══════════ -->
<div class="modal-wrap" id="confirmWrap">
  <div class="modal sm">
    <div class="confirm-body">
      <div class="confirm-icon">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>
      </div>
      <div class="confirm-ttl">Удалить запись?</div>
      <p class="confirm-txt" id="confirmTxt">Это действие нельзя отменить.</p>
    </div>
    <div class="modal-ftr">
      <button class="btn btn-ghost" onclick="closeConfirm()">Отмена</button>
      <button class="btn btn-danger-s" id="confirmOkBtn">Удалить</button>
    </div>
  </div>
</div>

<!-- ═══════════ DAY TOUR MODAL ═══════════ -->
<div class="modal-wrap" id="dayTourModalWrap">
  <div class="modal" style="max-width:680px;">
    <div class="modal-hdr">
      <div class="modal-title" id="dayTourModalTitle">ტურის დამატება</div>
      <button class="modal-close" onclick="closeDayTourModal()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <form id="dayTourForm" class="form-grid">
        <input type="hidden" id="dtDocId">

        <div class="fg full"><label>სახელი *</label><input type="text" id="dtName" placeholder="ტურის სახელი" required></div>

        <div class="fg full"><label>აღწერა *</label><textarea id="dtDesc" placeholder="ტურის აღწერა..." required></textarea></div>

        <div class="fg full"><label>მარშრუტი</label><input type="text" id="dtRoute" placeholder="თბილისი - მცხეთა - ჯვარი - ანანური"></div>

        <div class="fg full">
          <label>რეგიონი (შეარჩიეთ ერთი ან რამოდენიმე)</label>
          <div class="region-grid" id="regionGrid">
            <button type="button" class="region-chip" data-region="თბილისი">თბილისი</button>
            <button type="button" class="region-chip" data-region="კახეთი">კახეთი</button>
            <button type="button" class="region-chip" data-region="იმერეთი">იმერეთი</button>
            <button type="button" class="region-chip" data-region="სამეგრელო">სამეგრელო</button>
            <button type="button" class="region-chip" data-region="აჭარა">აჭარა</button>
            <button type="button" class="region-chip" data-region="გურია">გურია</button>
            <button type="button" class="region-chip" data-region="სვანეთი">სვანეთი</button>
            <button type="button" class="region-chip" data-region="რაჭა-ლეჩხუმი">რაჭა-ლეჩხუმი</button>
            <button type="button" class="region-chip" data-region="მცხეთა-მთიანეთი">მცხეთა-მთიანეთი</button>
            <button type="button" class="region-chip" data-region="შიდა ქართლი">შიდა ქართლი</button>
            <button type="button" class="region-chip" data-region="ქვემო ქართლი">ქვემო ქართლი</button>
            <button type="button" class="region-chip" data-region="სამცხე-ჯავახეთი">სამცხე-ჯავახეთი</button>
          </div>
        </div>

        <div class="fg">
          <label>ტიპი</label>
          <select id="dtType">
            <option value="ექსკურსია">ექსკურსია</option>
            <option value="საღვინე">საღვინე</option>
            <option value="თავგადასავლების">თავგადასავლების</option>
            <option value="კულტურული">კულტურული</option>
            <option value="ფოტოტური">ფოტოტური</option>
            <option value="გასტრონომიული">გასტრონომიული</option>
            <option value="ინდივიდუალური">ინდივიდუალური</option>
          </select>
        </div>

        <div class="fg"><label>ფასი (USD) *</label><input type="number" id="dtPrice" placeholder="45" min="1" required></div>

        <div class="fg full">
          <label>ხანგრძლივობა</label>
          <div class="duration-row">
            <div class="dur-field">
              <input type="number" id="dtDays" placeholder="0" min="0" value="1">
              <span class="dur-label">დღე</span>
            </div>
            <div class="dur-field">
              <input type="number" id="dtNights" placeholder="0" min="0" value="0">
              <span class="dur-label">ღამე</span>
            </div>
          </div>
        </div>

        <div class="fg"><label>მინ. პერსონალი *</label><input type="number" id="dtMinGroup" placeholder="1" min="1" required></div>
        <div class="fg"><label>მაქს. პერსონალი *</label><input type="number" id="dtMaxGroup" placeholder="15" min="1" required></div>

        <div class="fg full">
          <label>ფოტოები (აიტვირთება ImgBB-ზე)</label>
          <div class="upload-zone" id="dtUploadZone">
            <input type="file" id="dtPhotoInput" accept="image/*" multiple>
            <div class="upload-zone-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
            </div>
            <div class="upload-zone-text"><strong>აირჩიეთ ფოტოები</strong> ან გადმოიტანეთ აქ</div>
          </div>
          <div class="upload-progress" id="dtUploadProgress">იტვირთება...</div>
          <div class="uploaded-photos" id="dtUploadedPhotos"></div>
        </div>
      </form>
    </div>
    <div class="modal-ftr">
      <button class="btn btn-ghost" onclick="closeDayTourModal()">გაუქმება</button>
      <button class="btn btn-dark" onclick="saveDayTour()">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
        შენახვა
      </button>
    </div>
  </div>
</div>

<!-- Loading overlay -->
<div class="overlay" id="loadingOverlay">
  <div class="overlay-box">
    <div class="spinner"></div>
    <div class="overlay-label" id="loadingLabel">Сохранение...</div>
    <div class="overlay-sub">Идёт запись в Firebase</div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- ═══════════ FIREBASE ═══════════ -->
<script type="module">
  import { initializeApp }   from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getDatabase, ref, get, set, push, update, remove, child, serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  /* ── Config ── */
  const app = initializeApp({
    apiKey:            "AIzaSyATX_3r8vsgBU_iHWPTI11Q_vvIXRQhRB0",
    authDomain:        "damqtravel.firebaseapp.com",
    databaseURL:       "https://damqtravel-default-rtdb.firebaseio.com",
    projectId:         "damqtravel",
    storageBucket:     "damqtravel.firebasestorage.app",
    messagingSenderId: "84352735773",
    appId:             "1:84352735773:web:ec9095f9020b630b1884f4",
    measurementId:     "G-3TFFBQWHNM"
  });
  const db = getDatabase(app);

  /* ── RTDB helpers ── */
  async function rtdbGetAll(path) {
    const snap = await get(ref(db, path));
    if (!snap.exists()) return [];
    const val = snap.val();
    return Object.entries(val).map(([id, data]) => ({ id, ...data }));
  }
  async function rtdbAdd(path, data) {
    const newRef = push(ref(db, path));
    await set(newRef, data);
    return newRef.key;
  }
  async function rtdbUpdate(path, id, data) {
    await update(ref(db, `${path}/${id}`), data);
  }
  async function rtdbRemove(path, id) {
    await remove(ref(db, `${path}/${id}`));
  }

  /* ── UI helpers ── */
  function showLoading(msg = 'Сохранение...') {
    document.getElementById('loadingLabel').textContent = msg;
    document.getElementById('loadingOverlay').classList.add('show');
  }
  function hideLoading() {
    document.getElementById('loadingOverlay').classList.remove('show');
  }

  function toast(msg, type = 'ok') {
    const el = document.getElementById('toast');
    el.textContent = msg;
    el.className = `toast ${type} show`;
    setTimeout(() => el.classList.remove('show'), 3500);
  }

  function fmtDate(ts) {
    if (!ts) return '—';
    const d = new Date(ts);
    if (isNaN(d.getTime())) return '—';
    return d.toLocaleDateString('ru-RU', { day:'2-digit', month:'2-digit', year:'2-digit' });
  }

  function stars(n) {
    const r = Math.round(n || 0);
    return '★'.repeat(r) + '☆'.repeat(5 - r);
  }

  const STATUS_CLASS = {
    new:'b-blue', contacted:'b-gold', confirmed:'b-green',
    completed:'b-gray', cancelled:'b-red',
    approved:'b-green', pending:'b-gold', rejected:'b-red'
  };
  const STATUS_LBL = {
    new:'Новая', contacted:'Связались', confirmed:'Подтверждена',
    completed:'Завершена', cancelled:'Отменена',
    approved:'Одобрен', pending:'На проверке', rejected:'Отклонён'
  };
  const TYPE_LBL = { day:'Однодневный', multi:'Многодневный', wine:'Винный', photo:'Фото', custom:'Индив.' };

  function badgeCls(s)  { return STATUS_CLASS[s] || 'b-gray'; }
  function badgeLbl(s)  { return STATUS_LBL[s]   || s; }

  /* ── Navigation ── */
  const PAGE_META = {
    dashboard: ['Дашборд',        'Обзор DAMQ Travel'],
    tours:     ['Управление турами','Добавляйте и редактируйте туры'],
    bookings:  ['Заявки',          'Запросы от клиентов'],
    reviews:   ['Отзывы',          'Управление отзывами клиентов'],
    dayTours:  ['1-დღიანი ტურები', 'დაამატეთ და მართეთ 1-დღიანი ტურები']
  };

  window.switchPage = function(pg) {
    document.querySelectorAll('.nav-item[data-page]').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    const btn = document.querySelector(`.nav-item[data-page="${pg}"]`);
    if (btn) btn.classList.add('active');
    const pagEl = document.getElementById(`${pg}Page`);
    if (pagEl) pagEl.classList.add('active');
    const [ttl, sub] = PAGE_META[pg] || ['—',''];
    document.getElementById('pgTitle').textContent = ttl;
    document.getElementById('pgSub').textContent   = sub;
    document.getElementById('btnAddTour').style.display = pg === 'tours' ? 'inline-flex' : 'none';
    if (pg === 'tours')    loadTours();
    if (pg === 'bookings') loadBookings();
    if (pg === 'reviews')  loadReviews();
    if (pg === 'dayTours') loadDayTours();
    document.getElementById('sidebar').classList.remove('open');
  };

  document.querySelectorAll('.nav-item[data-page]').forEach(b => {
    b.addEventListener('click', () => switchPage(b.dataset.page));
  });

  document.getElementById('hamburger').addEventListener('click', () => {
    document.getElementById('sidebar').classList.toggle('open');
  });

  /* ── Close modals on overlay click ── */
  ['tourModalWrap','bookModalWrap','confirmWrap','dayTourModalWrap'].forEach(id => {
    document.getElementById(id).addEventListener('click', e => {
      if (e.target.id === id) document.getElementById(id).classList.remove('open');
    });
  });

  /* ══════════════ DASHBOARD ══════════════ */
  async function loadDashboard() {
    try {
      const [tours, bookings, reviews, dayTours] = await Promise.all([
        rtdbGetAll('tours'),
        rtdbGetAll('bookings'),
        rtdbGetAll('reviews'),
        rtdbGetAll('dayTours')
      ]);

      document.getElementById('sTours').textContent      = tours.length;
      document.getElementById('sBookings').textContent    = bookings.length;
      document.getElementById('sReviews').textContent     = reviews.length;
      document.getElementById('cntTours').textContent     = tours.length;
      document.getElementById('cntBookings').textContent  = bookings.length;
      document.getElementById('cntReviews').textContent   = reviews.length;
      document.getElementById('cntDayTours').textContent  = dayTours.length;

      const pending = bookings.filter(b => (b.status || 'new') === 'new').length;
      document.getElementById('sPending').textContent = pending;

      const recent = bookings
        .sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0))
        .slice(0, 6);

      const tb = document.getElementById('recentTbody');
      if (recent.length === 0) {
        tb.innerHTML = `<tr><td colspan="5" style="text-align:center;padding:2rem;color:#bbb;">Заявок пока нет</td></tr>`;
      } else {
        tb.innerHTML = recent.map(b => `
          <tr>
            <td data-label="Имя"><strong>${b.name || '—'}</strong></td>
            <td data-label="Тур">${b.tour || '—'}</td>
            <td data-label="Телефон">${b.phone || '—'}</td>
            <td data-label="Статус"><span class="badge ${badgeCls(b.status||'new')}">${badgeLbl(b.status||'new')}</span></td>
            <td data-label="Дата">${fmtDate(b.createdAt)}</td>
          </tr>`).join('');
      }
    } catch(e) { console.error('Dashboard:', e); }
  }

  /* ══════════════ TOURS ══════════════ */
  let allTours = [];

  async function loadTours() {
    document.getElementById('toursTbody').innerHTML =
      `<tr class="loading-row"><td colspan="7">Загрузка...</td></tr>`;
    try {
      allTours = await rtdbGetAll('tours');
      renderTours(allTours);
      document.getElementById('cntTours').textContent = allTours.length;
      document.getElementById('sTours').textContent   = allTours.length;
    } catch(e) {
      document.getElementById('toursTbody').innerHTML =
        `<tr><td colspan="7" style="text-align:center;padding:2rem;color:#e55;">Ошибка загрузки</td></tr>`;
    }
  }

  function renderTours(list) {
    const tb = document.getElementById('toursTbody');
    if (!list.length) {
      tb.innerHTML = `<tr><td colspan="7" style="text-align:center;padding:2.5rem;color:#bbb;">Туры ещё не добавлены</td></tr>`;
      return;
    }
    tb.innerHTML = list.map(t => `
      <tr>
        <td data-label="Название">
          <div class="tour-name-cell">
            ${t.image ? `<img src="${t.image}" class="thumb" alt="" onerror="this.style.display='none'">` : ''}
            <strong>${t.name || '—'}</strong>
          </div>
        </td>
        <td data-label="Тип"><span class="badge b-blue">${TYPE_LBL[t.type] || t.type || '—'}</span></td>
        <td data-label="Цена"><strong>$${t.price || '—'}</strong></td>
        <td data-label="Длит.">${t.duration || '—'}</td>
        <td data-label="Группа">${t.group || '—'}</td>
        <td data-label="Метка">${t.badge ? `<span class="badge b-gold">${t.badge}</span>` : '—'}</td>
        <td data-label="Действия">
          <div class="action-btns">
            <button class="btn-icon edit" title="Редактировать" onclick="editTour('${t.id}')">
              <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
            </button>
            <button class="btn-icon del" title="Удалить" onclick="confirmDeleteTour('${t.id}','${(t.name||'').replace(/'/g,"\\'")}')">
              <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/></svg>
            </button>
          </div>
        </td>
      </tr>`).join('');
  }

  document.getElementById('toursSearch').addEventListener('input', e => {
    const q = e.target.value.toLowerCase();
    renderTours(allTours.filter(t => (t.name||'').toLowerCase().includes(q)));
  });

  /* Tour modal */
  window.openTourModal = function() {
    document.getElementById('tourModalTitle').textContent = 'Новый тур';
    document.getElementById('tourForm').reset();
    document.getElementById('tourDocId').value = '';
    document.getElementById('tourModalWrap').classList.add('open');
  };
  window.closeTourModal = function() {
    document.getElementById('tourModalWrap').classList.remove('open');
  };

  window.editTour = function(id) {
    const t = allTours.find(x => x.id === id);
    if (!t) return;
    document.getElementById('tourModalTitle').textContent = 'Редактировать тур';
    document.getElementById('tourDocId').value  = t.id;
    document.getElementById('fName').value      = t.name     || '';
    document.getElementById('fDesc').value      = t.desc     || '';
    document.getElementById('fType').value      = t.type     || 'day';
    document.getElementById('fPrice').value     = t.price    || '';
    document.getElementById('fDuration').value  = t.duration || '';
    document.getElementById('fGroup').value     = t.group    || '';
    document.getElementById('fBadge').value     = t.badge    || '';
    document.getElementById('fRating').value    = t.rating   || '';
    document.getElementById('fImage').value     = t.image    || '';
    document.getElementById('fLocation').value  = t.location || '';
    document.getElementById('fIncludes').value  = (t.includes || []).join(', ');
    document.getElementById('tourModalWrap').classList.add('open');
  };

  window.saveTour = async function() {
    const docId = document.getElementById('tourDocId').value;
    const name  = document.getElementById('fName').value.trim();
    const price = Number(document.getElementById('fPrice').value);
    if (!name || !price) { toast('Заполните название и цену', 'err'); return; }

    const now = Date.now();
    const data = {
      name,
      desc:      document.getElementById('fDesc').value.trim(),
      type:      document.getElementById('fType').value,
      price,
      duration:  document.getElementById('fDuration').value.trim(),
      group:     document.getElementById('fGroup').value.trim(),
      badge:     document.getElementById('fBadge').value,
      rating:    parseFloat(document.getElementById('fRating').value) || null,
      image:     document.getElementById('fImage').value.trim(),
      location:  document.getElementById('fLocation').value.trim(),
      includes:  document.getElementById('fIncludes').value.split(',').map(s => s.trim()).filter(Boolean),
      updatedAt: now
    };

    closeTourModal();
    showLoading(docId ? 'Обновление тура...' : 'Добавление тура...');
    try {
      if (docId) {
        await rtdbUpdate('tours', docId, data);
        toast('Тур обновлён');
      } else {
        data.createdAt = now;
        await rtdbAdd('tours', data);
        toast('Тур добавлен');
      }
      loadTours();
    } catch(e) {
      toast('Ошибка: ' + e.message, 'err');
    } finally {
      hideLoading();
    }
  };

  window.confirmDeleteTour = function(id, name) {
    openConfirm(`Удалить тур «${name}»?`, async () => {
      showLoading('Удаление тура...');
      try {
        await rtdbRemove('tours', id);
        toast('Тур удалён');
        loadTours();
        loadDashboard();
      } catch(e) { toast('Ошибка: ' + e.message, 'err'); }
      finally { hideLoading(); }
    });
  };

  /* ══════════════ BOOKINGS ══════════════ */
  let allBookings = [];

  async function loadBookings() {
    document.getElementById('bookingsTbody').innerHTML =
      `<tr class="loading-row"><td colspan="8">Загрузка...</td></tr>`;
    try {
      allBookings = (await rtdbGetAll('bookings'))
        .sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
      renderBookings(allBookings);
      document.getElementById('cntBookings').textContent = allBookings.length;
    } catch(e) {
      document.getElementById('bookingsTbody').innerHTML =
        `<tr><td colspan="8" style="text-align:center;padding:2rem;color:#e55;">Ошибка загрузки</td></tr>`;
    }
  }

  function renderBookings(list) {
    const tb = document.getElementById('bookingsTbody');
    if (!list.length) {
      tb.innerHTML = `<tr><td colspan="8" style="text-align:center;padding:2.5rem;color:#bbb;">Заявок пока нет</td></tr>`;
      return;
    }
    tb.innerHTML = list.map(b => `
      <tr>
        <td data-label="Имя"><strong>${b.name || '—'}</strong></td>
        <td data-label="Телефон">${b.phone || '—'}</td>
        <td data-label="Email">${b.email || '—'}</td>
        <td data-label="Тур"><span class="badge b-blue">${b.tour || '—'}</span></td>
        <td data-label="Сообщение" style="max-width:160px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${b.message || '—'}</td>
        <td data-label="Статус"><span class="badge ${badgeCls(b.status||'new')}">${badgeLbl(b.status||'new')}</span></td>
        <td data-label="Дата">${fmtDate(b.createdAt)}</td>
        <td data-label="Действия">
          <div class="action-btns">
            <button class="btn-icon edit" title="Изменить статус" onclick="openBookModal('${b.id}','${b.status||'new'}')">
              <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
            </button>
            <button class="btn-icon del" title="Удалить" onclick="confirmDeleteBooking('${b.id}')">
              <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/></svg>
            </button>
          </div>
        </td>
      </tr>`).join('');
  }

  document.getElementById('bookSearch').addEventListener('input', e => {
    const q = e.target.value.toLowerCase();
    renderBookings(allBookings.filter(b => (b.name||'').toLowerCase().includes(q) || (b.phone||'').includes(q)));
  });

  window.openBookModal = function(id, status) {
    document.getElementById('bookDocId').value  = id;
    document.getElementById('bookStatus').value = status;
    document.getElementById('bookModalWrap').classList.add('open');
  };
  window.closeBookModal = function() {
    document.getElementById('bookModalWrap').classList.remove('open');
  };

  window.saveBookStatus = async function() {
    const id     = document.getElementById('bookDocId').value;
    const status = document.getElementById('bookStatus').value;
    closeBookModal();
    showLoading('Обновление статуса...');
    try {
      await rtdbUpdate('bookings', id, { status, updatedAt: Date.now() });
      toast('Статус обновлён');
      loadBookings();
      loadDashboard();
    } catch(e) { toast('Ошибка: ' + e.message, 'err'); }
    finally { hideLoading(); }
  };

  window.confirmDeleteBooking = function(id) {
    openConfirm('Удалить эту заявку?', async () => {
      showLoading('Удаление...');
      try {
        await rtdbRemove('bookings', id);
        toast('Заявка удалена');
        loadBookings();
        loadDashboard();
      } catch(e) { toast('Ошибка: ' + e.message, 'err'); }
      finally { hideLoading(); }
    });
  };

  /* ══════════════ REVIEWS ══════════════ */
  let allReviews = [];

  async function loadReviews() {
    document.getElementById('reviewsTbody').innerHTML =
      `<tr class="loading-row"><td colspan="7">Загрузка...</td></tr>`;
    try {
      allReviews = (await rtdbGetAll('reviews'))
        .sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
      renderReviews(allReviews);
      document.getElementById('cntReviews').textContent = allReviews.length;
      document.getElementById('sReviews').textContent   = allReviews.length;
    } catch(e) {
      document.getElementById('reviewsTbody').innerHTML =
        `<tr><td colspan="7" style="text-align:center;padding:2rem;color:#e55;">Ошибка загрузки</td></tr>`;
    }
  }

  function renderReviews(list) {
    const tb = document.getElementById('reviewsTbody');
    if (!list.length) {
      tb.innerHTML = `<tr><td colspan="7" style="text-align:center;padding:2.5rem;color:#bbb;">Отзывов пока нет</td></tr>`;
      return;
    }
    tb.innerHTML = list.map(r => `
      <tr>
        <td data-label="Автор"><strong>${r.firstName||''} ${r.lastName||''}</strong></td>
        <td data-label="Страна">${r.country || '—'}</td>
        <td data-label="Оценка"><span class="stars">${stars(r.rating)}</span></td>
        <td data-label="Отзыв" style="max-width:200px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${r.text || '—'}</td>
        <td data-label="Статус"><span class="badge ${badgeCls(r.status||'pending')}">${badgeLbl(r.status||'pending')}</span></td>
        <td data-label="Дата">${fmtDate(r.createdAt)}</td>
        <td data-label="Действия">
          <div class="action-btns">
            ${r.status !== 'approved' ? `
            <button class="btn-icon approve" title="Одобрить" onclick="approveReview('${r.id}')">
              <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
            </button>` : ''}
            <button class="btn-icon del" title="Удалить" onclick="confirmDeleteReview('${r.id}')">
              <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/></svg>
            </button>
          </div>
        </td>
      </tr>`).join('');
  }

  document.getElementById('revSearch').addEventListener('input', e => {
    const q = e.target.value.toLowerCase();
    renderReviews(allReviews.filter(r =>
      (`${r.firstName||''} ${r.lastName||''}`).toLowerCase().includes(q)
    ));
  });

  window.approveReview = async function(id) {
    showLoading('Одобрение отзыва...');
    try {
      await rtdbUpdate('reviews', id, { status: 'approved', updatedAt: Date.now() });
      toast('Отзыв одобрен');
      loadReviews();
    } catch(e) { toast('Ошибка: ' + e.message, 'err'); }
    finally { hideLoading(); }
  };

  window.confirmDeleteReview = function(id) {
    openConfirm('Удалить этот отзыв?', async () => {
      showLoading('Удаление...');
      try {
        await rtdbRemove('reviews', id);
        toast('Отзыв удалён');
        loadReviews();
        loadDashboard();
      } catch(e) { toast('Ошибка: ' + e.message, 'err'); }
      finally { hideLoading(); }
    });
  };

  /* ══════════════ DAY TOURS (1-დღიანი) ══════════════ */
  const IMGBB_KEY = 'c5bb67f26ff290d597182f756d153d50';
  let allDayTours = [];
  let dtUploadedImages = []; // array of { url, deleteUrl }

  // Region chip multi-select
  document.querySelectorAll('#regionGrid .region-chip').forEach(chip => {
    chip.addEventListener('click', () => chip.classList.toggle('selected'));
  });

  function getSelectedRegions() {
    return Array.from(document.querySelectorAll('#regionGrid .region-chip.selected'))
      .map(c => c.dataset.region);
  }

  function setSelectedRegions(regions) {
    document.querySelectorAll('#regionGrid .region-chip').forEach(c => {
      c.classList.toggle('selected', (regions || []).includes(c.dataset.region));
    });
  }

  // ImgBB upload
  async function uploadToImgBB(file) {
    const formData = new FormData();
    formData.append('image', file);
    const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, {
      method: 'POST',
      body: formData
    });
    const json = await res.json();
    if (!json.success) throw new Error(json.error?.message || 'Upload failed');
    return { url: json.data.url, thumb: json.data.thumb?.url || json.data.url, deleteUrl: json.data.delete_url || '' };
  }

  function renderUploadedPhotos() {
    const container = document.getElementById('dtUploadedPhotos');
    container.innerHTML = dtUploadedImages.map((img, i) => `
      <div class="uploaded-photo">
        <img src="${img.thumb || img.url}" alt="photo ${i+1}">
        <button type="button" class="remove-photo" onclick="removeDtPhoto(${i})">&times;</button>
      </div>
    `).join('');
  }

  window.removeDtPhoto = function(idx) {
    dtUploadedImages.splice(idx, 1);
    renderUploadedPhotos();
  };

  // File input handler
  const dtPhotoInput = document.getElementById('dtPhotoInput');
  const dtUploadZone = document.getElementById('dtUploadZone');

  dtPhotoInput.addEventListener('change', async (e) => {
    const files = Array.from(e.target.files);
    if (!files.length) return;
    const progress = document.getElementById('dtUploadProgress');
    progress.classList.add('active');

    for (let i = 0; i < files.length; i++) {
      progress.textContent = `იტვირთება ${i+1}/${files.length}...`;
      try {
        const result = await uploadToImgBB(files[i]);
        dtUploadedImages.push(result);
        renderUploadedPhotos();
      } catch (err) {
        toast('ფოტოს ატვირთვის შეცდომა: ' + err.message, 'err');
      }
    }
    progress.classList.remove('active');
    dtPhotoInput.value = '';
  });

  // Drag & drop
  dtUploadZone.addEventListener('dragover', e => { e.preventDefault(); dtUploadZone.classList.add('dragging'); });
  dtUploadZone.addEventListener('dragleave', () => dtUploadZone.classList.remove('dragging'));
  dtUploadZone.addEventListener('drop', e => {
    e.preventDefault();
    dtUploadZone.classList.remove('dragging');
    dtPhotoInput.files = e.dataTransfer.files;
    dtPhotoInput.dispatchEvent(new Event('change'));
  });

  // Load day tours from separate 'dayTours' node
  async function loadDayTours() {
    document.getElementById('dayToursTbody').innerHTML =
      `<tr class="loading-row"><td colspan="8">იტვირთება...</td></tr>`;
    try {
      allDayTours = await rtdbGetAll('dayTours');
      renderDayTours(allDayTours);
      document.getElementById('cntDayTours').textContent = allDayTours.length;
    } catch(e) {
      document.getElementById('dayToursTbody').innerHTML =
        `<tr><td colspan="8" style="text-align:center;padding:2rem;color:#e55;">შეცდომა: ${e.message}</td></tr>`;
    }
  }

  function renderDayTours(list) {
    const tb = document.getElementById('dayToursTbody');
    if (!list.length) {
      tb.innerHTML = `<tr><td colspan="8" style="text-align:center;padding:2.5rem;color:#bbb;">ტურები ჯერ არ დამატებულა</td></tr>`;
      return;
    }
    tb.innerHTML = list.map(t => {
      const dur = [];
      if (t.days) dur.push(t.days + ' დღე');
      if (t.nights) dur.push(t.nights + ' ღამე');
      const photos = (t.photos || []);
      return `
      <tr>
        <td data-label="სახელი">
          <div class="tour-name-cell">
            ${photos.length ? `<img src="${photos[0].thumb || photos[0].url}" class="thumb" alt="" onerror="this.style.display='none'">` : ''}
            <strong>${t.name || '—'}</strong>
          </div>
        </td>
        <td data-label="რეგიონი">${(t.regions || []).map(r => `<span class="badge b-gold" style="margin:1px;">${r}</span>`).join(' ') || '—'}</td>
        <td data-label="ტიპი"><span class="badge b-blue">${t.type || '—'}</span></td>
        <td data-label="ფასი"><strong>$${t.price || '—'}</strong></td>
        <td data-label="ხანგრძლივობა">${dur.join(', ') || '—'}</td>
        <td data-label="ჯგუფი">${t.minGroup || '?'} – ${t.maxGroup || '?'} პერს.</td>
        <td data-label="ფოტო">${photos.length} ფოტო</td>
        <td data-label="მოქმედება">
          <div class="action-btns">
            <button class="btn-icon edit" title="რედაქტირება" onclick="editDayTour('${t.id}')">
              <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
            </button>
            <button class="btn-icon del" title="წაშლა" onclick="confirmDeleteDayTour('${t.id}','${(t.name||'').replace(/'/g,"\\'")}')">
              <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/></svg>
            </button>
          </div>
        </td>
      </tr>`;
    }).join('');
  }

  document.getElementById('dayToursSearch').addEventListener('input', e => {
    const q = e.target.value.toLowerCase();
    renderDayTours(allDayTours.filter(t => (t.name||'').toLowerCase().includes(q)));
  });

  // Open / close modal
  window.openDayTourModal = function() {
    document.getElementById('dayTourModalTitle').textContent = 'ტურის დამატება';
    document.getElementById('dayTourForm').reset();
    document.getElementById('dtDocId').value = '';
    document.getElementById('dtDays').value = '1';
    document.getElementById('dtNights').value = '0';
    dtUploadedImages = [];
    renderUploadedPhotos();
    setSelectedRegions([]);
    document.getElementById('dayTourModalWrap').classList.add('open');
  };

  window.closeDayTourModal = function() {
    document.getElementById('dayTourModalWrap').classList.remove('open');
  };

  window.editDayTour = function(id) {
    const t = allDayTours.find(x => x.id === id);
    if (!t) return;
    document.getElementById('dayTourModalTitle').textContent = 'ტურის რედაქტირება';
    document.getElementById('dtDocId').value   = t.id;
    document.getElementById('dtName').value    = t.name || '';
    document.getElementById('dtDesc').value    = t.desc || '';
    document.getElementById('dtRoute').value   = t.route || '';
    document.getElementById('dtType').value    = t.type || 'ექ��კურსია';
    document.getElementById('dtPrice').value   = t.price || '';
    document.getElementById('dtDays').value    = t.days ?? 1;
    document.getElementById('dtNights').value  = t.nights ?? 0;
    document.getElementById('dtMinGroup').value = t.minGroup || '';
    document.getElementById('dtMaxGroup').value = t.maxGroup || '';
    setSelectedRegions(t.regions || []);
    dtUploadedImages = (t.photos || []).slice();
    renderUploadedPhotos();
    document.getElementById('dayTourModalWrap').classList.add('open');
  };

  window.saveDayTour = async function() {
    const docId = document.getElementById('dtDocId').value;
    const name  = document.getElementById('dtName').value.trim();
    const price = Number(document.getElementById('dtPrice').value);
    const minGroup = Number(document.getElementById('dtMinGroup').value);
    const maxGroup = Number(document.getElementById('dtMaxGroup').value);
    if (!name || !price || !minGroup || !maxGroup) {
      toast('შეავსეთ ყველა სავალდებულო ველი', 'err');
      return;
    }

    const now = Date.now();
    const data = {
      name,
      desc:     document.getElementById('dtDesc').value.trim(),
      route:    document.getElementById('dtRoute').value.trim(),
      regions:  getSelectedRegions(),
      type:     document.getElementById('dtType').value,
      price,
      days:     parseInt(document.getElementById('dtDays').value) || 0,
      nights:   parseInt(document.getElementById('dtNights').value) || 0,
      minGroup,
      maxGroup,
      photos:   dtUploadedImages,
      updatedAt: now
    };

    closeDayTourModal();
    showLoading(docId ? 'ტურის განახლება...' : 'ტურის დამატება...');
    try {
      if (docId) {
        await rtdbUpdate('dayTours', docId, data);
        toast('ტური განახლდა');
      } else {
        data.createdAt = now;
        await rtdbAdd('dayTours', data);
        toast('ტური დაემატა');
      }
      await loadDayTours();
      loadDashboard();
    } catch(e) {
      toast('შეცდომა: ' + e.message, 'err');
    } finally {
      hideLoading();
    }
  };

  window.confirmDeleteDayTour = function(id, name) {
    openConfirm(`წაშალოთ ტური "${name}"?`, async () => {
      showLoading('ტურის წაშლა...');
      try {
        await rtdbRemove('dayTours', id);
        toast('ტური წაიშალა');
        loadDayTours();
        loadDashboard();
      } catch(e) { toast('შეცდომა: ' + e.message, 'err'); }
      finally { hideLoading(); }
    });
  };

  /* ══════════════ CONFIRM ══════════════ */
  let _confirmCb = null;
  function openConfirm(text, cb) {
    document.getElementById('confirmTxt').textContent = text;
    _confirmCb = cb;
    document.getElementById('confirmWrap').classList.add('open');
  }
  window.closeConfirm = function() {
    document.getElementById('confirmWrap').classList.remove('open');
    _confirmCb = null;
  };
  document.getElementById('confirmOkBtn').addEventListener('click', async () => {
    closeConfirm();
    if (_confirmCb) await _confirmCb();
  });

  /* ══════════════ INIT ══════════════ */
  loadDashboard();
</script>

</body>
</html>
